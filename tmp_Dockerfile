FROM node:22

ENV NODE_ENV=production \
	POPULATE_DB=true

# Install system dependencies
RUN apt-get update && apt-get install -y \
	dos2unix \
	netcat-openbsd \
	vim \
	&& rm -rf /var/lib/apt/lists/*

# Create app directory
RUN mkdir -p /home/app
WORKDIR /home/app
SHELL ["/bin/bash", "-c"]

# Optional SSH (only if needed)
# RUN apt-get install -y openssh-server
# RUN echo "root:Docker!" | chpasswd
# RUN mkdir /run/sshd
# COPY sshd_config /etc/ssh/

# Copy application code
COPY . .

# Convert and make scripts executable
RUN dos2unix ./scripts/start.sh && chmod +x ./scripts/start.sh

# Install dependencies
RUN npm install

# Expose app port
EXPOSE 3000

# Start the app
ENTRYPOINT ["/bin/bash", "scripts/start.sh"]
